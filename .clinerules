# Claw City - Project Rules & Context

## Project Overview
Claw City ist eine Comedy-Show mit KI-Agenten in einer deutschen Kleinstadt.
17 Charaktere (KI-Agenten) interagieren in verschiedenen Settings (Café, Bäckerei, Selbsthilfegruppe, etc.).

## Art Style
- Simpsons/Futurama Cartoon-Stil für Bildgenerierung
- Roboter-Charaktere mit unterschiedlichen Designs
- Warme, freundliche Farbpalette

## Directory Structure

```
claw-city/
├── assets/
│   ├── characters/           # Charakter-Templates (Markdown)
│   │   └── {char_id}/
│   │       ├── profile.md
│   │       ├── backstory.md
│   │       └── visual_traits.md
│   └── world/
│       └── global_context.md
├── clawcity/                 # Core Python Package
│   ├── cli/                  # CLI Implementation
│   ├── core/                 # Config & Models
│   ├── pipeline/             # Engine Logic
│   └── services/             # Audio, Images, Video Services
├── configs/
│   ├── characters.yaml       # Globale Charakter-Liste
│   └── pipeline_settings.yaml
├── data/                     # Pipeline Daten (YAML)
│   ├── characters/           # Strukturierte Charakter-Prompts
│   ├── locations/            # Strukturierte Location-Prompts
│   └── config/               # visual_style.yaml
├── scripts/
│   ├── ep01_v3.yaml          # Episoden-Skripte (30-40 Szenen)
│   ├── ep02_v3.yaml
│   └── ...
├── src/
│   └── prompt_builder.py     # Zentraler Prompt Generator
├── output/                   # Generierte Medien
│   └── ep{XX}/
│       ├── audio_openai/
│       ├── images/
│       ├── video_openai/
│       └── EP{XX}_FULL.mp4
└── clawcity.py               # Haupt-CLI-Einstiegspunkt
```

## Key Components

### Prompt Generation (`src/prompt_builder.py`)
- Nutzt YAMLs aus `data/characters/` und `data/locations/`
- Integriert `data/config/visual_style.yaml`
- Erstellt konsistente Prompts für Flux (black-forest-labs/flux-schnell)

### Character Management
- `configs/characters.yaml` - Definition der Stimmen und IDs
- `data/characters/*.yaml` - Visuelle Details für die Bildgenerierung
- `./clawcity list` - Zeigt alle verfügbaren Charaktere

### Pipeline Workflow
1. **Audio:** OpenAI TTS (fable, nova, onyx, echo, alloy, shimmer)
2. **Images:** Flux via Replicate (nutzt Prompt Builder)
3. **Video:** FFmpeg (kombiniert Bild + Audio pro Szene)
4. **Full:** Mergt alle Szenen-Videos zu einer Episode

## Commands

```bash
# Venv aktivieren
. venv/bin/activate

# Status prüfen
python3 clawcity.py status -e 1

# Full Pipeline (Audio → Bilder → Video → Full Episode)
python3 clawcity.py build --episode 1 --full

# Einzelne Stages
python3 clawcity.py build -e 1 --stage audio
python3 clawcity.py build -e 1 --stage images
python3 clawcity.py build -e 1 --stage video
python3 clawcity.py build -e 1 --stage full
```

## Implementation Rules (Kritisch)
- **Feature-Vollständigkeit:** Jedes Feature muss Daten (YAML), Logik (Service/Builder) und CLI-Integration umfassen.
- **Konsistenz:** Alle 17 Charaktere müssen in `data/characters/` definiert sein.
- **Fehlerbehandlung:** Robuste Prüfung auf fehlende YAML-Dateien oder API-Keys.
- **DRY:** Gemeinsame Logik gehört in `clawcity/utils/` oder `src/prompt_builder.py`.

## Important Notes
- Rate Limit: 6 Bilder/Minute bei Flux (Replicate)
- Kosten pro Episode: ~$0.12 (TTS + Bilder)
- Auflösung: 1920x1080 (16:9)
- Episoden-Länge: Variabel, basierend auf YAML-Skript (meist 25-40 Szenen)
